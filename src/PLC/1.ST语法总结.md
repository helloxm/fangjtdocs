---
title: PLC 数据类型和特殊控件
index: 100
---

# ST核心元素特点归纳（ABB AC500适配，通俗举例+易记特点）
以下把你提到的**8个内置FB（R_TRIG/F_TRIG/TP/TON/TOFF/CTU/CTD）+4个变量声明段（VAR/VAR_TEMP/VAR_INPUT/VAR_OUTPUT）** 按「**变量声明段**（基础，所有FB依赖）+**内置功能块**（分3类：边沿检测/定时器/计数器）」分类，每类提炼**核心特点+通俗举例+关键避坑**，全部贴合ABB AC500 ST编程习惯，无复杂术语，一看就懂、一记就牢。

## 一、变量声明段（4个）：决定变量「作用范围+是否保持值」
所有ST变量/FB实例**必须先声明再使用**，这4个是最基础的声明段，核心区别在**作用范围**（哪里能访问）和**值是否跨扫描周期保持**，直接决定FB（如TON/CTU）能否正常工作，是PLC编程的「地基」。
### 1. VAR ：全局/模块内静态变量段（**必用核心**）
- **核心特点**：① 仅在当前程序（PRG/FB/FC）内可访问；② **跨扫描周期保持值**（PLC断电/复位前，值不会自动清零）；③ 可声明普通变量、FB实例（定时器/计数器/边沿检测）。
- **通俗举例**：声明TON定时器实例`Ton_Delay : TON;`、计数变量`iCount : INT := 0;`，PLC扫描100次后，`iCount`累加的数值会保留，定时器的计时值也会持续累积。
- **关键避坑**：**所有内置FB（R_TRIG/TON/CTU等）必须声明在这里**，否则无法保持状态，直接失效。

### 2. VAR_INPUT ：输入变量段（**对外接收数据**）
- **核心特点**：① 从外部（如主程序、触摸屏、其他FB）接收数据，**只能读、不能写**；② 跨扫描周期保持值；③ 常用于PRG/FB的外部触发信号、参数传入。
- **通俗举例**：主程序声明`bStartBtn : BOOL;`（启动按钮），外部DI点（现场按钮）的信号传入该变量，程序内只能判断`bStartBtn=TRUE/FALSE`，不能给它赋值`bStartBtn:=TRUE;`。
- **典型用法**：现场IO信号（按钮、传感器）、远程控制参数（Modbus写入的定时器预设值）。

### 3. VAR_OUTPUT ：输出变量段（**对外反馈数据**）
- **核心特点**：① 向外部（如触摸屏、DO点、其他FB）反馈数据，**程序内可写、外部可读**；② 跨扫描周期保持值；③ 常用于程序的执行结果、设备状态输出。
- **通俗举例**：声明`bMotorRun : BOOL;`（电机运行状态），程序内通过逻辑赋值`bMotorRun:=TRUE;`，外部触摸屏可读取该值显示「电机运行」，也可连接DO点控制电机接触器。
- **典型用法**：设备状态（运行/停止/故障）、程序执行结果（计数到/计时到）、现场执行器控制信号。

### 4. VAR_TEMP ：临时变量段（**仅单次扫描有效**）
- **核心特点**：① 仅在当前程序内可访问；② **不跨扫描周期保持**（单次扫描结束后，值自动清零，下次扫描重新初始化）；③ 只能声明普通变量，**禁止声明FB实例**。
- **通俗举例**：声明临时计算变量`iTemp : INT;`，扫描周期内用它计算`iTemp:=iA+iB;`，扫描结束后`iTemp`立即清零，下次扫描时`iTemp`是随机值（未初始化）。
- **关键避坑**：**绝对不能声明FB实例**（如`Rtrig_Demo : R_TRIG;`），否则FB无法保持上一周期状态，边沿检测、定时器、计数器全部失效。

### 变量段核心区别速记表
| 声明段       | 作用范围       | 值是否保持 | 可声明FB实例 | 读写权限       | 典型用途                     |
|--------------|----------------|------------|--------------|----------------|------------------------------|
| VAR          | 程序内         | 是         | ✅ 必须这里  | 程序内可读写   | FB实例、内部静态变量/中间变量 |
| VAR_INPUT    | 程序内（外部传）| 是         | ❌ 不能      | 仅读（程序内） | 现场IO、外部传入参数         |
| VAR_OUTPUT   | 程序内（外部读）| 是         | ❌ 不能      | 程序内可写     | 设备状态、执行结果、DO控制   |
| VAR_TEMP     | 程序内         | 否         | ❌ 禁止      | 程序内可读写   | 单次扫描的临时计算变量       |

## 二、内置功能块（8个）：分3类（边沿检测/定时器/计数器）
均为IEC 61131-3标准FB，ABB AC500原生支持，**统一使用规则**：① VAR段声明实例；② 调用语法`实例名(参数:=输入, 参数=>输出);`；③ 靠PLC循环扫描工作，无需手写核心逻辑。
### 第一类：边沿检测FB（2个）：信号「跳变瞬间」的「单次触发神器」
核心作用：检测BOOL信号的**瞬间跳变**，输出**仅1个扫描周期的短脉冲**（ms级），解决「长按信号重复触发定时器/计数器」的问题，是工业编程的「触发开关」。
#### 1. R_TRIG ：上升沿检测（FALSE→TRUE）
- **核心特点**：仅检测信号从「断（FALSE）→通（TRUE）」的瞬间，输出1个扫描周期的TRUE；信号持续通、断→通，均不触发。
- **通俗举例**：现场按钮按下（FALSE→TRUE），R_TRIG输出1个短脉冲，触发TP定时器输出2秒脉冲；即使按钮一直长按，R_TRIG也不再触发，避免定时器重复工作。
- **调用示例（ABB AC500直接用）**：
  ```st
  VAR
      Rtrig_Btn : R_TRIG; // VAR段声明实例
      bBtn : BOOL;        // 按钮信号
      bPulse : BOOL;      // 上升沿短脉冲输出
  END_VAR
  Rtrig_Btn(CLK:=bBtn, Q=>bPulse); // 按钮按下瞬间，bPulse=TRUE（1个扫描周期）
  ```

#### 2. F_TRIG ：下降沿检测（TRUE→FALSE）
- **核心特点**：仅检测信号从「通（TRUE）→断（FALSE）」的瞬间，输出1个扫描周期的TRUE；其余情况均为FALSE，和R_TRIG是「反向双胞胎」。
- **通俗举例**：电机运行信号从TRUE→FALSE（电机停止），F_TRIG输出短脉冲，触发TOFF定时器，让散热风机延时30秒停止。
- **调用示例**：
  ```st
  VAR
      Ftrig_Motor : F_TRIG;
      bMotorRun : BOOL; // 电机运行信号
      bStopPulse : BOOL;// 下降沿短脉冲输出
  END_VAR
  Ftrig_Motor(CLK:=bMotorRun, Q=>bStopPulse); // 电机停止瞬间，bStopPulse=TRUE
  ```

### 第二类：定时器FB（3个）：累计「时间」，实现「延时/脉冲」控制
核心作用：靠PLC扫描周期**累积时间**，实现延时启动、延时停止、固定时长脉冲，核心参数统一（IN/PT/Q/ET），仅**触发逻辑+输出特性**不同，TIME类型参数均用`T#xMS/T#xS`赋值。
#### 1. TON ：通电延时定时器（**最常用**）
- **核心特点**：① IN=TRUE（持续通）时，开始累积时间；② 累计时间ET≥PT（预设），Q=TRUE；③ IN=FALSE时，**立即清零ET**，Q=FALSE，重新计时。
- **通俗举例**：按下启动按钮（IN=TRUE），延时5秒（PT=T#5S）后，指示灯亮（Q=TRUE）；如果按钮按了2秒松开（IN=FALSE），计时清零，指示灯始终不亮。
- **典型用途**：设备启动延时、按钮防误触、报警延时触发。
- **调用示例**：
  ```st
  VAR Ton_Delay : TON; bStart : BOOL; bLight : BOOL; END_VAR
  Ton_Delay(IN:=bStart, PT:=T#5S, Q=>bLight); // 启动后5秒，指示灯亮
  ```

#### 2. TOFF ：断电延时定时器
- **核心特点**：① IN=TRUE时，Q**立即=TRUE**，不计时；② IN从TRUE→FALSE（断电）时，开始累积时间；③ 累计时间ET≥PT，Q=FALSE；④ IN重新=TRUE，立即清零ET，Q=TRUE。
- **通俗举例**：电机运行时（IN=TRUE），散热风机立即转（Q=TRUE）；电机停止（IN=FALSE），风机延时30秒（PT=T#30S）后停止（Q=FALSE）；如果电机停止5秒后重新启动，风机继续运行。
- **典型用途**：设备散热延时、指示灯断电延时灭、阀门延时关闭。
- **调用示例**：
  ```st
  VAR Toff_Fan : TOFF; bMotor : BOOL; bFan : BOOL; END_VAR
  Toff_Fan(IN:=bMotor, PT:=T#30S, Q=>bFan); // 电机停，风机延时30秒停
  ```

#### 3. TP ：脉冲定时器（**点动/防抖核心**）
- **核心特点**：① IN从FALSE→TRUE（上升沿）时，Q**立即=TRUE**，开始计时；② 无论IN是否持续TRUE（长按），Q仅保持PT时长，计时到后Q=FALSE；③ 计时中IN再次上升沿，**重新计时**。
- **通俗举例**：点动按钮按下（无论短按/长按），气缸立即动作（Q=TRUE），仅保持2秒（PT=T#2S）后自动复位；即使按钮一直按，气缸也只动作2秒，避免长按连续动作。
- **典型用途**：点动控制、传感器信号防抖、单步工序触发。
- **调用示例**：
  ```st
  VAR Tp_Jog : TP; bJogBtn : BOOL; bCylinder : BOOL; END_VAR
  Tp_Jog(IN:=bJogBtn, PT:=T#2S, Q=>bCylinder); // 点动按钮，气缸动作2秒
  ```

### 第三类：计数器FB（2个）：累计「信号边沿次数」，实现「数量计数」
核心作用：靠**信号上升沿**累积「次数」，替代定时器的「时间累积」，和定时器是「镜像逻辑」，核心参数（IN/PT/Q/CV），CV为当前计数值（替代定时器的ET），PT为预设计数值（整数型）。
#### 1. CTU ：加计数器（**最常用**）
- **核心特点**：① IN每来1个上升沿，当前计数值CV**+1**；② CV≥PT（预设）时，Q=TRUE（计数到）；③ R=TRUE（复位）时，**CV清零**，Q=FALSE，重新计数。
- **通俗举例**：产品经过传感器（IN每来1个上升沿=1个产品），预设计数100个（PT=100），计数到100个时，料仓满报警（Q=TRUE）；按下复位按钮（R=TRUE），计数清零，重新开始。
- **典型用途**：产品计数、下料计数、工位触发次数计数。
- **调用示例**：
  ```st
  VAR Ctu_Count : CTU; bSensor : BOOL; bReset : BOOL; bFull : BOOL; iCV : UINT; END_VAR
  Ctu_Count(IN:=bSensor, R:=bReset, PT:=100, Q=>bFull, CV=>iCV); // 计数100个，料仓满
  ```

#### 2. CTD ：减计数器
- **核心特点**：① 初始时CV=PT（预设值）；② IN每来1个上升沿，CV**-1**；③ CV≤0时，Q=TRUE（计数到0）；④ LD=TRUE（装载）时，**CV恢复为PT**，Q=FALSE，重新计数。
- **通俗举例**：料仓初始有50个物料（PT=50），每下料1个（IN上升沿），计数减1；计数到0时，料仓空报警（Q=TRUE）；按下补料按钮（LD=TRUE），计数恢复50，重新开始。
- **典型用途**：剩余物料计数、设备剩余运行次数计数、料仓空仓提醒。
- **调用示例**：
  ```st
  VAR Ctd_Empty : CTD; bFeed : BOOL; bLoad : BOOL; bEmpty : BOOL; iCV : UINT; END_VAR
  Ctd_Empty(IN:=bFeed, LD:=bLoad, PT:=50, Q=>bEmpty, CV=>iCV); // 剩余50个，到0空仓报警
  ```

### 内置FB核心区别速记表（3类8个，ABB AC500通用）
| 类别       | FB名称 | 核心检测/累积对象 | 核心触发逻辑 | 输出（Q）置1条件 | 复位/清零条件 | 典型用途               |
|------------|--------|------------------|--------------|-----------------|---------------|------------------------|
| **边沿检测** | R_TRIG | 信号跳变         | FALSE→TRUE   | 跳变瞬间（1个扫描周期） | 无（自动复位） | 单次触发、防重复计数   |
|            | F_TRIG | 信号跳变         | TRUE→FALSE   | 跳变瞬间（1个扫描周期） | 无（自动复位） | 停止瞬间触发、延时停止 |
| **定时器**   | TON    | 时间（扫描累积） | IN=TRUE持续  | ET≥PT（延时到）| IN=FALSE      | 延时启动、防误触       |
|            | TOFF   | 时间（扫描累积） | IN=TRUE→FALSE | ET≥PT（延时到）| IN=TRUE       | 延时停止、设备散热     |
|            | TP     | 时间（扫描累积） | IN=FALSE→TRUE | 触发后立即置1，保持PT | 计时到自动复位 | 点动控制、信号防抖     |
| **计数器**   | CTU    | 上升沿次数       | IN上升沿     | CV≥PT（计数到）| R=TRUE        | 产品计数、料仓满报警   |
|            | CTD    | 上升沿次数       | IN上升沿     | CV≤0（计数到0）| LD=TRUE       | 剩余物料计数、空仓报警 |

## 三、核心组合用法（工业现场100%用到，举例强化）
单独用FB场景少，现场都是**组合使用**，核心是「边沿检测+定时器/计数器」，解决「长按/持续信号重复触发」问题，举2个最经典的组合，直接复刻到ABB AC500即可用：
### 组合1：R_TRIG + TP ：按钮长按仅触发1次固定脉冲（点动核心）
```st
VAR
    Rtrig_Btn : R_TRIG; // 上升沿检测
    Tp_Jog : TP;        // 脉冲定时器
    bJogBtn : BOOL;     // 点动按钮
    bCylinder : BOOL;   // 气缸输出
    bR_Pulse : BOOL;    // 上升沿短脉冲
END_VAR
// 第一步：检测按钮上升沿，避免长按
Rtrig_Btn(CLK:=bJogBtn, Q=>bR_Pulse);
// 第二步：上升沿脉冲触发TP，输出2秒固定脉冲
Tp_Jog(IN:=bR_Pulse, PT:=T#2S, Q=>bCylinder);
```
**效果**：按钮按下一次（无论短按/长按），气缸仅动作2秒，彻底避免长按重复触发。

### 组合2：R_TRIG + CTU ：传感器信号仅计数1次/个（防重复计数）
```st
VAR
    Rtrig_Sensor : R_TRIG;
    Ctu_Product : CTU;
    bSensor : BOOL;     // 产品传感器
    bReset : BOOL;      // 复位按钮
    bFull : BOOL;       // 计数到报警
    bR_Pulse : BOOL;
    iCV : UINT;
END_VAR
// 第一步：检测传感器上升沿，避免信号持续通导致重复计数
Rtrig_Sensor(CLK:=bSensor, Q=>bR_Pulse);
// 第二步：上升沿脉冲触发计数，每1个产品仅计数1次
Ctu_Product(IN:=bR_Pulse, R:=bReset, PT:=100, Q=>bFull, CV=>iCV);
```
**效果**：产品经过传感器，即使传感器信号持续通（产品停留），也仅计数1次，避免多计数。

## 四、终极速记口诀（一句话记牢核心）
### 变量段
VAR静态保状态，FB实例必放这；
INPUT入OUTPUT出，只读可写要记住；
TEMP临时一次性，FB声明别碰它。

### 内置FB
R升F降单脉冲，触发定时计数用；
TON通电延时到，TOFF断电延时停；
TP点动固定冲，长按也只来一次；
CTU加计数到满，CTD减计数到空；
计时计数靠扫描，VAR声明不失效。

